<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <script src="js/jquery-3.2.0.js"></script>
    <title></title>
</head>
<body>
<div id="edit">
    <button id="btnDelete">删除</button>
    <button id="btnEdit">编辑</button>
</div>

<div id="article">

</div>

<script>
    //根据文章id获取文章详情
    var id = location.search.slice(4);
    $.get('http://localhost/mongoProject/server/routes/viewArticle.php?id='+id)
     .then((data)=>{
        if(data.ok == 1){
            var result = data.result;
            $('#article').html(
            `
                <h5>${"标题："+result.title}</h5>
                <h6>${"作者："+result.author}</h6>
                 <p>${"正文："+result.content}</p>
            `
            )
        }
        valid(result.author);
    })

    //验证当前用户是本文章作者
    function valid(uname){
        console.log("uname is "+uname);
        $.get("http://localhost/mongoProject/server/routes/isAuthor.php?uname="+uname)
                .then((result)=>{
            console.log(result);
            if(result.ok == 0){
                $('#edit').hide();
            }
            else{
                $('#edit').show();
            }
        })
    }

    $('#btnDelete').click(()=>{
        var id = location.search.slice(4);
        if(confirm('确认删除文章吗')){
            if(confirm('你确定删除？？？')){
                $.get("http://localhost/mongoProject/server/routes/removeArticle.php?id="+id)
                        .then((result)=>{
                        if(result.ok == 1){
                            if(confirm('删除成功')){
                                location="index.html";
                            };
                        }
                        else{
                            alert('删除失败')
                        }
                })
            }
        }
    })

    //编辑文章
    $('#btnEdit').click(()=>{
        location = "edit.html?"+location.search.slice(4);;
    })
</script>


</body>
</html>